-- ----------------------------------------------------------------------------
-- Language Extensions
-- ----------------------------------------------------------------------------

{-# LANGUAGE NoImplicitPrelude #-}

-- ----------------------------------------------------------------------------
-- Module declaration
-- ----------------------------------------------------------------------------

module Control.Monad.Reader
  (
    Reader(..)
  ) where

-- ----------------------------------------------------------------------------
-- External imports
-- ----------------------------------------------------------------------------

import Prelude ((.), ($), const)

-- ----------------------------------------------------------------------------
-- Internal imports
-- ----------------------------------------------------------------------------

import Control.Monad
import Functor.Applicative
import Functor.Covariant

-- ----------------------------------------------------------------------------
-- Reader data type definition
-- ----------------------------------------------------------------------------

newtype Reader e a = Reader { runReader :: e -> a }

-- ----------------------------------------------------------------------------
-- Reader instance for Covariant
-- ----------------------------------------------------------------------------

instance Covariant (Reader e) where
  fmap f (Reader g) = Reader (f . g)

-- ----------------------------------------------------------------------------
-- Reader instance for Applicative
-- ----------------------------------------------------------------------------

instance Applicative (Reader e) where
  pure x = Reader (const x)
  Reader f <*> Reader g = Reader $ \x -> f x (g x)

-- ----------------------------------------------------------------------------
-- Reader instance for Monad
-- ----------------------------------------------------------------------------

instance Monad (Reader e) where
  join (Reader f) = Reader $ \x -> runReader (f x) x
